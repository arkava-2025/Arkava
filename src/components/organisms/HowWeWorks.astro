---
import Section from '@/components/atoms/Section.astro';
import Title from '@/components/atoms/Title.astro';
import Container from '../molecules/Container.astro';

const { whatsapp } = Astro.props as { whatsapp?: string };
const waNumber = (whatsapp ?? '573016075815').replace(/\D/g, '');
const waText = encodeURIComponent(
  'Bienvenido a Arkava Quiero iniciar un proyecto',
);

const steps = [
  {
    id: 'Evaluacion Tecnica',
    number: '01',
    title: 'Evaluacion Tecnica',
    tooltip: 'Idea inicial y objetivos del proyecto.',
    position: 'above' as const,
  },
  {
    id: 'Planeacion y Presupuesto',
    number: '02',
    title: 'Planeacion y Presupuesto',
    tooltip: 'Roadmap, alcance y tiempos de entrega.',
    position: 'below' as const,
  },
  {
    id: 'Ejecucion',
    number: '03',
    title: 'Ejecucion',
    tooltip: 'UI/UX, wireframes y prototipos.',
    position: 'above' as const,
  },
  {
    id: 'Supervision y Control',
    number: '04',
    title: 'Supervision y Control',
    tooltip: 'Desarrollo, integraciones y pruebas.',
    position: 'below' as const,
  },
  {
    id: 'Entrega final',
    number: '05',
    title: 'Entrega final',
    tooltip: 'Puesta en producci√≥n y soporte inicial.',
    position: 'above' as const,
  },
];
---

<Section style="w-full bg-[#1f1f23]">
  <Container style="flex-col items-center">
    <!-- Optional heading -->
    <Title title="Nuestro proceso" style="mb-16 text-white" />

    <!-- Timeline container -->
    <div class="relative w-full">
      <!-- Horizontal connector line (visible en >sm). Positioned at 50% to cross marker centers -->
      <div
        class="block sm:block absolute left-0 right-0 top-1/2 transform -translate-y-1/2"
      >
        <div
          class="mx-6 w-0.5 h-full sm:w-auto sm:h-0.5"
          style="background: linear-gradient(90deg, rgba(174,154,145,0.15) 0%, rgba(174,154,145,0.15) 100%);"
        >
        </div>
      </div>

      <!-- Steps: on small screens stacked vertically, on sm+ horizontal and spaced -->
      <ul
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-8 sm:gap-0 relative z-10"
      >
        {
          steps.map((step) => (
            <li
              class="sm:w-1/5 flex flex-col items-center h-full"
              id={`step-${step.id}`}
            >
              {/* Desktop title above (only when position === 'above') */}
              {step.position === 'above' && (
                <div class="relative  group pb-4 hidden sm:flex sm:h-6 sm:items-center">
                  <button
                    class="text-sm font-medium text-[#AE9A91] focus:outline-none"
                    aria-describedby={`tip-${step.id}`}
                    type="button"
                  >
                    {step.number} {step.title}
                  </button>
                  <div
                    role="tooltip"
                    id={`tip-${step.id}`}
                    class="pointer-events-none absolute -top-2 left-1/2 -translate-x-1/2 -translate-y-full whitespace-nowrap rounded bg-[#2a2a2e] px-3 py-2 text-xs text-white opacity-0 shadow-lg ring-1 ring-black/10 transition-opacity group-hover:opacity-100 group-focus-within:opacity-100"
                  >
                    {step.tooltip}
                  </div>
                </div>
              )}

              {/* Placeholder for spacing when title is below on desktop */}
              {step.position === 'below' && (
                <span class="hidden sm:block mb-4 h-6">&nbsp;</span>
              )}

              {/* Marker */}
              <div class="relative">
                <div class="w-12 h-12 rounded-full border-2 border-[#E35205] flex items-center justify-center bg-transparent">
                  <div class="w-3 h-3 rounded-full bg-[#E35205]" />
                </div>
              </div>

              {/* Bottom title: mobile-only if position === 'above'; visible on all if 'below' */}
              <div
                class={`relative inline-block group mt-4 ${step.position === 'above' ? 'sm:hidden' : ''} ${step.position === 'below' ? 'sm:min-h-[1.5rem] sm:flex sm:items-center' : ''}`}
              >
                <button
                  class="text-sm font-medium text-[#AE9A91] focus:outline-none"
                  aria-describedby={`tip-${step.id}-mobile`}
                  type="button"
                >
                  {step.number} {step.title}
                </button>
                <div
                  role="tooltip"
                  id={`tip-${step.id}-mobile`}
                  class="pointer-events-none absolute top-full left-1/2 -translate-x-1/2 mt-2 whitespace-nowrap rounded bg-[#2a2a2e] px-3 py-2 text-xs text-white opacity-0 shadow-lg ring-1 ring-black/10 transition-opacity group-hover:opacity-100 group-focus-within:opacity-100"
                >
                  {step.tooltip}
                </div>
              </div>

              {/* Bottom spacer to balance height on desktop when title is above */}
              {step.position === 'above' && (
                <span class="hidden sm:block h-6" />
              )}
            </li>
          ))
        }
      </ul>
    </div>

    <!-- CTA Button -->
    <div class="mt-16">
      <a
        href={`https://wa.me/${waNumber}?text=${waText}`}
        class="inline-block px-8 py-3 rounded-md border-2 border-[#E35205] text-[#E35205] font-medium hover:bg-[#E35205] hover:text-white transition-colors duration-200"
      >
        Iniciemos juntos
      </a>
    </div>
  </Container>
</Section>
