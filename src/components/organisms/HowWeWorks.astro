---
import Section from '@/components/atoms/Section.astro';
import Title from '@/components/atoms/Title.astro';
import Container from '../molecules/Container.astro';

const { whatsapp } = Astro.props as { whatsapp?: string };
const waNumber = (whatsapp ?? '573016075815').replace(/\D/g, '');
const waText = encodeURIComponent(
  'Bienvenido a Arkava Quiero iniciar un proyecto',
);

const steps = [
  {
    id: 'Evaluacion Tecnica',
    number: '01',
    title: 'Evaluacion Tecnica',
    tooltip:
      'Cada proyecto comienza con una mirada experta. Analizamos el espacio, escuchamos tus ideas y comprendemos la esencia de lo que quieres lograr.Nuestro propósito: transformar tu visión en un concepto arquitectónico sólido y posible.',
    position: 'above' as const,
  },
  {
    id: 'Planeacion y Presupuesto',
    number: '02',
    title: 'Planeacion y Presupuesto',
    tooltip:
      'Convertimos la idea en un plan claro. Diseñamos cada detalle, seleccionamos los materiales adecuados y definimos un presupuesto transparente que equilibra estética, calidad y funcionalidad.',
    position: 'below' as const,
  },
  {
    id: 'Ejecucion',
    number: '03',
    title: 'Ejecucion',
    tooltip:
      'Aquí tu proyecto cobra vida. Nuestro equipo coordina cada etapa con precisión, cuidando los tiempos, los acabados y la armonía del resultado.',
    position: 'above' as const,
  },
  {
    id: 'Supervision y Control',
    number: '04',
    title: 'Supervision y Control',
    tooltip:
      'Cada detalle merece ser cuidado con precisión. Por eso, acompañamos cada etapa con una supervisión dedicada y personalizada, asegurando que todo se realice según lo acordado y que los acabados reflejen la elegancia, el orden y la calidad que definen a Arkava.',
    position: 'below' as const,
  },
  {
    id: 'Entrega final',
    number: '05',
    title: 'Entrega final',
    tooltip:
      'Entregamos tu proyecto a satisfacción, verificando que cada detalle cumpla con los estándares acordados y refleje la calidad que prometimos desde el inicio. Un resultado impecable, listo para disfrutarse.',
    position: 'above' as const,
  },
];
---

<Section style="w-full bg-[#1f1f23]">
  <Container style="flex-col items-center">
    <!-- Optional heading -->
    <Title title="Nuestro proceso" style="mb-16 text-white" />

    <!-- Timeline container -->
    <div class="relative w-full">
      <!-- Horizontal connector line (visible en >sm). Positioned at 50% to cross marker centers -->
      <div
        class="block sm:block absolute left-0 right-0 top-1/2 transform -translate-y-1/2"
      >
        <div
          class="mx-6 w-0.5 h-full sm:w-auto sm:h-0.5"
          style="background: linear-gradient(90deg, rgba(174,154,145,0.15) 0%, rgba(174,154,145,0.15) 100%);"
        >
        </div>
      </div>

      <!-- Steps: on small screens stacked vertically, on sm+ horizontal and spaced -->
      <ul
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-8 sm:gap-0 relative z-10"
      >
        {
          steps.map((step) => (
            <li
              class="sm:w-1/5 flex flex-col items-center h-full group"
              id={`step-${step.id}`}
            >
              {/* Desktop title above (only when position === 'above') */}
              {step.position === 'above' && (
                <div class="relative pb-4 hidden sm:flex sm:h-6 sm:items-center">
                  <button
                    class="text-sm font-medium text-[#AE9A91] focus:outline-none hover:text-[#E35205] transition-colors"
                    aria-describedby={`tip-${step.id}`}
                    type="button"
                  >
                    {step.number} {step.title}
                  </button>
                </div>
              )}

              {/* Placeholder for spacing when title is below on desktop */}
              {step.position === 'below' && (
                <span class="hidden sm:block mb-4 h-6">&nbsp;</span>
              )}

              {/* Marker */}
              <div class="relative">
                <button
                  class="w-12 h-12 rounded-full border-2 border-[#E35205] flex items-center justify-center bg-transparent hover:bg-[#E35205]/10 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-[#E35205]/50"
                  aria-describedby={`tip-${step.id}`}
                  type="button"
                >
                  <div class="w-3 h-3 rounded-full bg-[#E35205]" />
                </button>

                {/* Unified Tooltip */}
                <div
                  role="tooltip"
                  id={`tip-${step.id}`}
                  class={`pointer-events-none absolute left-1/2 -translate-x-1/2 rounded bg-[#fff] px-3 py-2 text-xs text-gray-900 opacity-0 shadow-lg ring-1 ring-black/10 transition-opacity group-hover:opacity-100 group-focus-within:opacity-100 w-[250px] z-20 ${step.position === 'above' ? 'top-full mt-2' : '-top-2 -translate-y-full'}`}
                >
                  {step.tooltip}
                </div>
              </div>

              {/* Bottom title: mobile-only if position === 'above'; visible on all if 'below' */}
              <div
                class={`relative inline-block mt-4 ${step.position === 'above' ? 'sm:hidden' : ''} ${step.position === 'below' ? 'sm:min-h-[1.5rem] sm:flex sm:items-center' : ''}`}
              >
                <button
                  class="text-sm font-medium text-[#AE9A91] focus:outline-none hover:text-[#E35205] transition-colors"
                  aria-describedby={`tip-${step.id}`}
                  type="button"
                >
                  {step.number} {step.title}
                </button>
              </div>

              {/* Bottom spacer to balance height on desktop when title is above */}
              {step.position === 'above' && (
                <span class="hidden sm:block h-6" />
              )}
            </li>
          ))
        }
      </ul>
    </div>

    <!-- CTA Button -->
    <div class="mt-16">
      <a
        href={`https://wa.me/${waNumber}?text=${waText}`}
        class="inline-block px-8 py-3 rounded-md border-2 border-[#E35205] text-[#E35205] font-medium hover:bg-[#E35205] hover:text-white transition-colors duration-200"
      >
        Iniciemos juntos
      </a>
    </div>
  </Container>
</Section>
